window.compareEthnicityMapModule=window.compareEthnicityMapModule||function(){var i=["de","en","es","fr","ru","zh"],r=["place-label","place-label-md","place-label-sm","state-label","state-label-abbr","country-label","road-label","water-label","poi-label"];function c(e,t,o,n,a){n.accessToken=e;var l=new n.Map({attributionControl:!1,container:o,interactive:!0,maxZoom:7,minZoom:0,scrollZoom:!1,style:"light"===t?"mapbox://styles/ancestrymapbox/cji3es8jo1jie2rqxlxj7rkcc":"mapbox://styles/ancestrymapbox/cji3frio60ede2rofjxhndhpk",touchZoomRotate:!1,trackResize:!0,zoom:0});return l.dragRotate.disable(),l.touchZoomRotate.disableRotation(),l.on("load",function(){!function(e,t){for(var o=(t||"").split("-")[0],n=0<=i.indexOf(o)?"{name_"+o+"}":"{name}",a=0;a<r.length;a++)e.setLayoutProperty(r[a],"text-field",n)}(l,a),l.setLayoutProperty("road-label","visibility","none"),l.easeTo({zoom:0})}),l}var d={initMap:function(o,n,a,l){var i=$.Deferred();return a?f.whenModuleAvailable("mapboxgl",function(e){var t=c(o,n,a,e,l);f.whenXIsAvailable(function(){return t.isStyleLoaded()},function(){i.resolve(t)},function(){i.reject(new Error("couldn't successfully check if map style loaded"))},"map.isStyleLoaded")}):i.reject(),i},mapRegion:function(a,l,e){l=l||{},e=e.replace("{ethnicityVersion}",l.ev).replace("{regionKey}",l.id),window.setTimeout(function(){f.ajaxGet(e,2e3,"json").done(function(e){var t=((e||{}).features||{}).features||[],o=t.length<=2?t[0]:t[1],n=l.left?"#489B9B":l.right?"#FFCD00":"#6BA410";!function(e,t,o,n){var a="s:"+t,l="l:"+t,i="ll:"+t;e.addSource(a,{type:"geojson",data:o}),e.addLayer({id:l,type:"fill",source:a,paint:{"fill-color":n,"fill-opacity":.7}},"water"),e.addLayer({id:i,type:"line",source:a,paint:{"line-color":"#FFF","line-width":2,"line-opacity":1}},"place-label")}(a,l.id+"."+l.ev,o,n)})},0)},mapRegions:function(c,s,u){var n=$.Deferred();return f.ajaxGet(u.cdnAssetVersion,5e3,"text").done(function(e){var t=u.regionPolygonsTemplate.replace("{assetCdnVersion}",e);if(s.leftOnly&&0<s.leftOnly.length)for(var o=0;o<s.leftOnly.length;o++){var n=s.leftOnly[o];n.left=!0,d.mapRegion(c,n,t)}if(s.rightOnly&&0<s.rightOnly.length)for(var a=0;a<s.rightOnly.length;a++){var l=s.rightOnly[a];l.right=!0,d.mapRegion(c,l,t)}if(s.both&&0<s.both.length)for(var i=0;i<s.both.length;i++){var r=s.both[i];r.both=!0,d.mapRegion(c,r,t)}}).fail(function(e,t,o){n.reject(new Error("unable to retrieve CDN asset version from: "+u.cdnAssetVersion))}),n},mapZoom:function(e,t){var o=parseInt(e.getZoom(),10);t?e.easeTo({zoom:Math.min(o+1,7)}):e.easeTo({zoom:Math.max(o-1,0)})},utilities:f},f={ajaxGet:function(e,t,o){return $.ajax({url:e,method:"GET",cache:!0,dataType:o,timeout:t,xhrFields:{withCredentials:!1}})},getModuleByName:function(e){return window[e]},whenModuleAvailable:function(e,t,o){f.whenXIsAvailable(function(){return f.getModuleByName(e)},function(){t(f.getModuleByName(e))},o,"whenModuleAvailable("+e+")")},whenXIsAvailable:function(e,t,o,n){var a=0,l=window.setInterval(function(){e()?(window.clearInterval(l),t()):200<(a+=1)&&(window.clearInterval(l),o&&o())},25)}};return d}();
!function(){var l={columnBreakPoint:3,maxMatches:6};try{$(".sharedMatches .conBody").addClass("loading");var e=_compareConstants.sharedMatchesUrl;$.ajax({url:e,type:"get",timeout:1e4,success:function(e){if(e){var a=function(e){var a=[];if(e&&e.matchGroups&&0<e.matchGroups.length)for(var s=0;s<e.matchGroups.length;s++){for(var t=e.matchGroups[s],r=0;r<t.matches.length;r++){var o=t.matches[r];if(!(0<l.maxMatches+1))break;if(o&&o.testGuid&&""!==o.testGuid&&o.matchTestDisplayName&&""!==o.matchTestDisplayName.trim()){var n={detailPageUrl:_compareConstants.dnaUrlPrefix+"/tests/"+_compareConstants.mySampleId+"/match/"+o.testGuid+"?filterBy=ALL&sortBy=RELATIONSHIP&page=1&"+_compareConstants.matchesDetailPageQs,displayName:o.matchTestDisplayName||"",displayInitials:c(o.matchTestDisplayName),relationship:(i=o.meiosisValue,void 0,d="meiosis"+i,_compareConstants.resources.sharedMatches[d]||""),sharedCm:o.sharedCentimorgans,testGuid:o.testGuid,userPhoto:o.userPhoto||""};a.push(n)}}if(l.maxMatches<0)break}var i,d;return a}(e);0<a.length?function(e){if($(".sharedMatches .conBody").removeClass("loading"),$(".sharedMatches #mobileViewAllBtn").removeClass("displayNone"),$(".sharedMatches #desktopViewAllBtn").removeClass("displayNone"),function(e){$(".sharedMatches .conBody").append('<div class="ancGrid full480"></div>');for(var a=$(".sharedMatches .conBody .ancGrid"),s=0;s<e.length&&s<l.maxMatches;s++){var t,r=e[s],o="row"+(s+1);s<l.columnBreakPoint?(a.append('<div class="ancCol ancColRow w50 col1" id="'+o+'"></div><div class="ancCol w50 col2 displayNone"></div>'),t=$("#"+o+".col1")):(o="row"+(s%l.columnBreakPoint+1),(t=$("#"+o).next()).removeClass("displayNone"));var n=" onclick=\"trackEvent('view shared match detail');\"",i='<div class="userCard userCardSize4">';r.userPhoto&&""!==r.userPhoto?i+='<a class="userCardImg userCardImgCenter" style="background-image:url(\''+r.userPhoto+'\');" href="'+r.detailPageUrl+'"'+n+'><img alt="'+r.displayName+'" src="'+r.userPhoto+'"></a>':i+='<a class="userCardImg userCardPortrait bgDark bgColor1" href="'+r.detailPageUrl+'" title="'+r.displayName+'"'+n+">"+r.displayInitials+"</a>",i+='<div class="userCardContent userCardContentSizeDefault"><a class="userCardTitle" href="'+r.detailPageUrl+'">'+r.displayName+'</a><p class="userCardSubTitle">'+r.relationship+d(r.sharedCm)+'</p><div><strong class="icon iconTreePedigree displayNone" data-test-guid="'+r.testGuid+'"></strong><strong class="icon iconLock Sand3 displayNone"></strong></div></div>',i+="</div>",s%l.columnBreakPoint<l.columnBreakPoint-1&&(i+="<hr />"),t.append(i)}}(e),"true"===_compareConstants.showTreeStatusForSharedMatches){var a=_compareConstants.treeStatusDataApi,s=function(e){var a=[];if(e&&0<e.length)for(var s=0;s<e.length;s++)e[s].testGuid&&a.push(e[s].testGuid);return a}(e),t=s;$.ajax({url:a,type:"post",timeout:1e4,contentType:"application/json",data:JSON.stringify(t),success:function(e){e&&!e.error?function(e){for(var a in e){var s=e[a],t=$(".sharedMatches .iconTreePedigree[data-test-guid='"+a+"']");t&&t.data("test-guid")===a&&(s.treeError||null===s.treeId&&!s.hasUnlinkedTree?(t.addClass("Sand3"),s.treeError&&t.text(_compareConstants.resources.sharedMatches.treeUnavailable||"Tree Unavailable"),null!==s.treeId||s.hasUnlinkedTree||t.text(_compareConstants.resources.sharedMatches.noTrees||"No Trees")):(s.privateTree?(t.addClass("Sand3"),t.siblings(".iconLock").removeClass("displayNone")):!1===s.privateTree&&t.addClass("Bamboo3"),s.hasUnlinkedTree?t.text(_compareConstants.resources.sharedMatches.unlinkedTree||"Unlinked Tree"):s.treeId&&void 0!==s.personCount&&null!==s.personCount&&t.text(s.personCount.toLocaleString(_compareConstants.culture)+(_compareConstants.resources.sharedMatches.people||" people"))),t.removeClass("displayNone"))}}(e):r(s)},error:function(e){r(s)}})}}(a):s()}else s()},error:function(e){a()}})}catch(e){a()}function r(e){var a=$(".sharedMatches .iconTreePedigree");a.addClass("Sand3"),a.text(_compareConstants.resources.sharedMatches.treeUnavailable||"Tree Unavailable"),a.removeClass("displayNone")}function s(){$(".sharedMatches .conBody").removeClass("loading"),$(".sharedMatches .conBody").addClass("displayNone"),$("#noSharedMatchesDescription").removeClass("displayNone")}function a(){$(".sharedMatches .conBody").removeClass("loading"),$(".sharedMatches .conBody").addClass("displayNone"),$(".sharedMatches #desktopViewAllBtn").addClass("displayNone"),$(".sharedMatches #mobileViewAllBtn").addClass("displayNone"),$("#noSharedMatchesDescription").addClass("displayNone"),$("#sharedMatchesError").removeClass("displayNone")}function d(e){var a=30<=e?Math.round(e):e.toFixed(1),s=_compareConstants.resources.sharedMatches.sharedCm;return s=s.replace("{0}",a.toLocaleString(_compareConstants.culture))}function c(e){try{if(e&&""!==e.trim()){var a=e.split(/\s|\./);if(a&&0<(a=a.filter(function(e){return e&&""!==e})).length){var s=a[0],t="";if(1<a.length&&(t=a[a.length-1]),s&&""!==s){var r=o(s);return t&&""!==t?r+=o(t):1<s.length&&(r+=o(s.substring(1))),r}}}}catch(e){return""}return""}function o(e){return e&&""!==e?e[0].toString().toUpperCase():""}}();
!function(){function t(){$("#uploadPhotoContents .alert").addClass("displayNone");var o=$("#uploadPhotoPreview").data("initials")||"";$("#uploadPhotoPreview").css("background-image",""),$("#uploadPhotoPreview span").text(o),$("#uploadPhotoPreview span").css("display","inline"),$("#fileNameText").text(""),$("#saveUploadBtn").attr("disabled","disabled")}function n(o,a,e){$.ajax({url:_compareConstants.photoUploadUrl,type:"post",data:o,cache:!1,timeout:6e4,contentType:!1,dataType:"json",processData:!1,success:a,error:e})}function e(){$("#saveUploadBtn").removeClass("loading"),$("#saveUploadBtn").removeAttr("disabled"),$("#uploadPhotoContents .alert").addClass("displayNone"),$("#uploadErrorGeneral").removeClass("displayNone")}function l(o,a,e,t){$("#"+t+" .addPhotoWrap").removeClass("displayNone"),$("#"+t+" .addPhotoWrapLoading").addClass("displayNone"),$("#mobileUploadErrorContents p").css("display","none"),$("#mobileUploadErrorContents").modal({onClose:function(){$("#mobileUploadErrorContents p").css("display","none")}}),o?$("#uploadMobileErrorGeneral").css("display","block"):a?$("#uploadMobileErrorSize").css("display","block"):e&&$("#uploadMobileErrorType").css("display","block")}function s(o){for(var a=["image/jpeg","image/png","image/tiff","image/gif","image/bmp"],e=0;e<a.length;e++)if(o.type===a[e])return!0;return!1}function d(o){return!(10485760<o.size)}$(".addPhotoLinkDesktop").on("click",function(){trackEvent("add photo clicked"),$("#uploadPhotoContents .alert").addClass("displayNone"),$("#saveUploadBtn").data("image-to-change",$(this).data("image-to-change"));var o=$(this).data("initials")||"";$("#uploadPhotoPreview").css("background-image",""),$("#uploadPhotoPreview").data("initials",o),$("#uploadPhotoPreview span").text(o),$("#uploadPhotoPreview span").css("display","inline"),$("#saveUploadBtn").attr("disabled","disabled"),$("#fileNameText").text(""),$("#saveUploadBtn").removeClass("loading"),$("#uploadPhotoContents").modal({hideCloseBtn:!0,onClose:function(){$("#uploadPhotoForm")[0].reset()}})}),$("#cancelUploadBtn").on("click",function(){$.modal.close(),$("#uploadPhotoForm")[0].reset()}),$("#saveUploadBtn").on("click",function(){var o=$("#photoInput")[0].files;if(o&&0<o.length){var a=new FormData($("#uploadPhotoForm")[0]);$("#saveUploadBtn").addClass("loading"),n(a,function(o){if(o){$("#saveUploadBtn").removeClass("loading"),$.modal.close();var a=$("#saveUploadBtn").data("image-to-change");$("#"+a).addClass("photo photoCenter"),$("#"+a+" .addPhotoWrap").css("display","none"),$("#"+a).css("background-image","url('"+_compareConstants.mediaSvcUrl.replace("{mediaId}",o)+"')")}else e()},e)}}),$("#photoInput").on("change",function(){var o=$("#photoInput")[0].files;if(o&&0<o.length){var a=o[0];if(s(a))if(d(a)){var e=window.URL.createObjectURL(a);$("#uploadPhotoContents .alert").addClass("displayNone"),$("#uploadPhotoPreview").css("background-image","url('"+e+"')"),$("#uploadPhotoPreview").css("background-size","cover"),$("#uploadPhotoPreview span").css("display","none"),$("#fileNameText").text(a.name),$("#saveUploadBtn").removeAttr("disabled")}else t(),$("#uploadErrorSize").removeClass("displayNone");else t(),$("#uploadErrorType").removeClass("displayNone")}}),$("#mobilePhotoInput").on("change",function(){var a=$("#mobilePhotoInput").data("image-to-change");$("#"+a+" .addPhotoWrapLoading").removeClass("displayNone"),$("#"+a+" .addPhotoWrap").addClass("displayNone");var o=$("#mobilePhotoInput")[0].files;if(o&&0<o.length){var e=o[0];if(s(e))if(d(e))n(new FormData($("#uploadPhotoFormMobile")[0]),function(o){o?($("#"+a).addClass("photo photoCenter"),$("#"+a).css("background-image","url('"+_compareConstants.mediaSvcUrl.replace("{mediaId}",o)+"')"),$("#"+a+" .addPhotoWrapLoading").addClass("displayNone")):l(!0,!1,!1,a)},function(){l(!0,!1,!1,a)});else l(!1,!0,!1,a);else l(!1,!1,!0,a)}})}();